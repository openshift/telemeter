rule_files:
- prom-local-alerts.conf

scrape_configs:
- job_name: 'telemeter-server'
  scrape_interval: 30s

  metrics_path: '/metrics'

  static_configs:
    - targets:
      - 'localhost:9104'

      labels:
        _id: 'test'
        _elide: 'integration-test'

- job_name: 'prom'
  scrape_interval: 30s

  metrics_path: '/metrics'

  static_configs:
    - targets:
      - 'localhost:9090'

      labels:
        _id: 'test'
        _elide: 'integration-test'

remote_write:
  - url: http://127.0.0.1:9103/metrics/v1/receive
    authorization:
      type: Bearer
      credentials: eyJhdXRob3JpemF0aW9uX3Rva2VuIjoiYSIsImNsdXN0ZXJfaWQiOiJ0ZXN0In0K
    metadata_config:
      send: false
    write_relabel_configs:
      - action: keep
        regex: 'ALERTS;firing'
        source_labels: [__name__,alertstate]
      - action: keep
        regex: scrape_samples_scraped
        source_labels: [__name__]
      - action: replace
        regex: ALERTS
        source_labels: [__name__]
        target_label: __name__
        replacement: alerts
      - action: replace
        regex: prometheus_build_info
        source_labels: [__name__]
        target_label: __name__
        replacement: build_info
      - action: replace
        regex: scrape_samples_scraped
        source_labels: [__name__]
        target_label: __name__
        replacement: scraped
